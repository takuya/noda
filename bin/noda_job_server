#!/usr/bin/env ruby
#
#  Created on 2011-5-12.
#  Copyright (c) 2011. All rights reserved.
#

require 'rubygems'
require 'daemons'
require File.expand_path(File.dirname(__FILE__) + "/../lib/noda")
#NodaJobServer::CLI.execute(STDOUT, ARGV)
KCODE='s'
options = {
    :dir_mode   => :script,
    :dir        => '/var/run',
    :multiple   => true,
    :ontop      => false,
    :mode       => :exec,
    :backtrace  => true,
    :monitor    => true
  }
require "socket" 
ip= IPSocket::getaddress(Socket::gethostname)

Daemons.run_proc("job_server",options){
  p ip
  s=Noda::JobServer.new(ip, "10001")
  m=Noda::JobMonitor.new(ip,"100080","druby://#{ip}:10001")
  s.start_service
}

